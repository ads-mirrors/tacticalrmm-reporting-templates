{
  "base_template": {
    "name": "TRMM_Base v1.1",
    "html": "<html>\n\n<head>\n    <style>\n        /* —— PDF page settings —— */\n        @page {\n            margin: 0.5in;\n            size: letter portrait;\n        }\n\n        /* —— Color palette (theme) —— */\n        :root {\n            --header-bg: #2c3e50;\n            --header-text: #ffffff;\n            --border-color: #dddddd;\n            --table-header-bg: #f2f2f2;\n            --status-ready-bg: #eaf7ec;\n            --status-ready-badge: #28a745;\n            --status-not-ready-bg: #fbebee;\n            --status-not-ready-badge: #dc3545;\n            --status-unknown-bg: #fff9e6;\n            --status-unknown-badge: #ffc107;\n            --badge-already-bg: #17a2b8;\n        }\n\n        /* —— Typography & utilities (structure) —— */\n        body {\n            font-family: sans-serif;\n            color: #333;\n            font-size: 12px;\n        }\n\n        .section {\n            margin-top: 20px;\n        }\n\n        .text-danger {\n            color: #a94442;\n            font-weight: bold;\n        }\n\n        /* —— Header layout (structure) —— */\n        .report-header {\n            background-color: var(--header-bg);\n            color: var(--header-text);\n            padding: 20px;\n            border-radius: 8px;\n            display: flex;\n            align-items: center;\n        }\n\n        .header-logo {\n            width: 80px;\n            margin-right: 25px;\n            flex-shrink: 0;\n        }\n\n        .header-date {\n            margin-left: auto;\n            text-align: right;\n            white-space: nowrap;\n        }\n\n        .report-header h1 {\n            font-size: 24px;\n            margin: 0 0 5px;\n        }\n\n        .report-header h2 {\n            font-size: 16px;\n            margin: 0;\n            opacity: 0.9;\n        }\n\n        /* —— Standardized Table Styles (structure) —— */\n        .report-table {\n            border-collapse: collapse;\n            width: 100%;\n        }\n\n        .report-table th,\n        .report-table td {\n            border: 1px solid var(--border-color);\n            padding: 6px 8px;\n            text-align: left;\n            vertical-align: top;\n        }\n\n        .report-table thead th {\n            background-color: var(--table-header-bg);\n            font-weight: bold;\n            cursor: pointer;\n            user-select: none;\n        }\n\n        /* Header label + sort indicators */\n        .th-topline {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n            gap: .4rem;\n        }\n\n        .th-label {\n            position: relative;\n            cursor: pointer;\n            user-select: none;\n        }\n\n        /* These are the specific rules that make the indicator visible */\n        th.sorted.asc .th-label::after {\n            content: \"▲\";\n            padding-left: .4rem;\n            color: #333;\n            font-size: .9em;\n        }\n\n        th.sorted.desc .th-label::after {\n            content: \"▼\";\n            padding-left: .4rem;\n            color: #333;\n            font-size: .9em;\n        }\n\n        .report-table thead th select {\n            width: 100%;\n            margin-top: 5px;\n            padding: 4px;\n            border-radius: 4px;\n            border: 1px solid #ccc;\n            font-weight: normal;\n            background: #fff;\n        }\n\n        /* —— Badge shape (structure) —— */\n        .status-badge {\n            display: inline-block;\n            padding: 4px 10px;\n            border-radius: 12px;\n            color: #fff;\n            font-weight: bold;\n            font-size: 11px;\n            text-align: center;\n            white-space: nowrap;\n        }\n\n        /* —— Stub classes for per‑report overrides —— */\n        .status-ready {}\n\n        .status-not-ready {}\n\n        .status-unknown {}\n\n        .badge-ready {}\n\n        .badge-not-ready {}\n\n        .badge-unknown {}\n\n        .badge-already {}\n    </style>\n</head>\n\n<body>\n    {% block content %}{% endblock %}\n</body>\n\n</html>"
  },
  "template": {
    "name": "Agent List_By Client v1.3",
    "template_css": "",
    "template_md": "{% block content %}\r\n<style>\r\n  /* This report works well in landscape mode to fit all columns */\r\n  @page { margin: 0.5in; size: letter landscape; }\r\n  /* Basic styling for demonstration */\r\n</style>\r\n\r\n<div class=\"report-header\">\r\n  <div class=\"header-logo\">\r\n    <img src=\"https://github.com/amidaware/reporting-templates/blob/master/assets/gbtnavy%20(256).png?raw=true\" alt=\"Amidaware Logo\" style=\"width: 80px; height: auto;\">\r\n  </div>\r\n  <div class=\"header-titles\">\r\n    <h1>Agent Information Report</h1>\r\n    <h2 id=\"report-subtitle\">Client: All | Site: All</h2>\r\n    <div class=\"row-count\" aria-live=\"polite\">\r\n        Filtered Row Count: <strong><span id=\"visibleCount\">0</span></strong> of <span id=\"totalCount\">{{ data_sources.agentsList | length }}</span>\r\n    </div>\r\n  </div>\r\n  <div class=\"header-date\">\r\n    <h2>Report Date:<br>{{ report_run_timestamp.strftime('%B %d, %Y') }}</h2>\r\n  </div>\r\n</div>\r\n\r\n{% set clients = data_sources.agentsList | map(attribute='site__client__name') | unique | sort %}\r\n{% set sites = data_sources.agentsList | map(attribute='site__name') | unique | sort %}\r\n\r\n<table id=\"reportTable\" class=\"report-table\" aria-describedby=\"report-subtitle\">\r\n  <thead>\r\n    <tr>\r\n      <!-- Client (col 0) -->\r\n      <th data-col=\"client\">\r\n        <div class=\"th-topline\">\r\n          <span class=\"th-label\">Client</span>\r\n          <span class=\"sort-indicator\" data-for-col=\"0\"></span>\r\n        </div>\r\n        <select id=\"clientFilterH\" aria-label=\"Client filter\">\r\n          <option value=\"all\">All Clients</option>\r\n          {% for client_name in clients %}\r\n          <option value=\"{{ client_name }}\">{{ client_name }}</option>\r\n          {% endfor %}\r\n        </select>\r\n      </th>\r\n\r\n      <!-- Site (col 1) -->\r\n      <th data-col=\"site\">\r\n        <div class=\"th-topline\">\r\n          <span class=\"th-label\">Site</span>\r\n          <span class=\"sort-indicator\" data-for-col=\"1\"></span>\r\n        </div>\r\n        <select id=\"siteFilterH\" aria-label=\"Site filter\">\r\n          <option value=\"all\">All Sites</option>\r\n          {% for site_name in sites %}\r\n          <option value=\"{{ site_name }}\">{{ site_name }}</option>\r\n          {% endfor %}\r\n        </select>\r\n      </th>\r\n\r\n      <!-- Device Name (col 2) -->\r\n      <th data-col=\"device\">\r\n        <div class=\"th-topline\">\r\n          <span class=\"th-label\">Device Name</span>\r\n          <span class=\"sort-indicator\" data-for-col=\"2\"></span>\r\n        </div>\r\n      </th>\r\n\r\n      <!-- User (col 3) -->\r\n      <th data-col=\"user\">\r\n        <div class=\"th-topline\">\r\n          <span class=\"th-label\">Last Logged In User</span>\r\n          <span class=\"sort-indicator\" data-for-col=\"3\"></span>\r\n        </div>\r\n      </th>\r\n\r\n      <!-- OS (col 4) -->\r\n      <th data-col=\"os\">\r\n        <div class=\"th-topline\">\r\n          <span class=\"th-label\">Operating System</span>\r\n          <span class=\"sort-indicator\" data-for-col=\"4\"></span>\r\n        </div>\r\n      </th>\r\n    </tr>\r\n  </thead>\r\n\r\n  <tbody id=\"report-table-body\">\r\n    {% for item in data_sources.agentsList %}\r\n    <tr>\r\n      <td class=\"cell-client\">{{ item.site__client__name }}</td>\r\n      <td class=\"cell-site\">{{ item.site__name }}</td>\r\n      <td class=\"cell-device\" data-sort-value=\"{{ item.hostname }}\">\r\n        <b class=\"device-name\">{{ item.hostname }}</b><br>\r\n        {% if item.last_seen %}\r\n        <small class=\"last-seen {% if (report_run_timestamp - item.last_seen).days > 30 %}text-danger{% endif %}\" data-sort-value=\"{{ item.last_seen.isoformat() }}\">\r\n          Last Seen: {{ item.last_seen.astimezone(ZoneInfo('America/New_York')).strftime('%Y-%m-%d %H:%M:%S') }}\r\n        </small>\r\n        {% else %}\r\n        <small class=\"last-seen\" data-sort-value=\"N/A\">&nbsp;</small>\r\n        {% endif %}\r\n      </td>\r\n      <td class=\"cell-user\">{{ item.last_logged_in_user }}</td>\r\n      <td class=\"cell-os break-word\">{{ item.operating_system }}</td>\r\n    </tr>\r\n    {% endfor %}\r\n  </tbody>\r\n</table>\r\n\r\n<script>\r\n(function() {\r\n  const $  = s => document.querySelector(s);\r\n  const $$ = s => Array.from(document.querySelectorAll(s));\r\n  const tbody = $('#report-table-body');\r\n\r\n  const selects = {\r\n    client: $('#clientFilterH'),\r\n    site:   $('#siteFilterH')\r\n  };\r\n\r\n  let currentSort = { colIndex: 0, dirAsc: true };\r\n\r\n  function getCellText(row, selector, fallbackIndex=null) {\r\n    const el = row.querySelector(selector);\r\n    if (el) return el.textContent.trim();\r\n    if (fallbackIndex !== null) return row.cells[fallbackIndex].textContent.trim();\r\n    return '';\r\n  }\r\n\r\n  function filterTable() {\r\n    const clientVal = selects.client?.value || 'all';\r\n    const siteVal   = selects.site?.value   || 'all';\r\n\r\n    let visible = 0;\r\n    $$('#reportTable tbody tr').forEach(row => {\r\n      const client = getCellText(row, '.cell-client', 0);\r\n      const site   = getCellText(row, '.cell-site', 1);\r\n\r\n      const show = (clientVal === 'all' || client === clientVal)\r\n                && (siteVal   === 'all' || site   === siteVal);\r\n\r\n      row.style.display = show ? '' : 'none';\r\n      if (show) visible++;\r\n    });\r\n\r\n    const clientName = selects.client.value === 'all' ? 'All' : selects.client.value;\r\n    const siteName = selects.site.value === 'all' ? 'All' : selects.site.value;\r\n    $('#report-subtitle').textContent = `Client: ${clientName} | Site: ${siteName}`;\r\n    $('#visibleCount').textContent = String(visible);\r\n\r\n    if (currentSort.colIndex !== null) sortTable(currentSort.colIndex, currentSort.dirAsc, false);\r\n  }\r\n\r\n  function setSortIndicator(colIndex, dirAscOrNull) {\r\n    $$('.sort-indicator').forEach(s => s.textContent = '');\r\n    if (dirAscOrNull === null) return;\r\n    const el = $(`.sort-indicator[data-for-col=\"${colIndex}\"]`);\r\n    if (el) el.textContent = dirAscOrNull ? '▲' : '▼';\r\n  }\r\n\r\n  function sortTable(colIndex, dirAsc = true, toggle = true) {\r\n    const rows = Array.from(tbody.rows);\r\n    const visibleRows = rows.filter(r => r.style.display !== 'none');\r\n\r\n    if (toggle) {\r\n      if (currentSort.colIndex === colIndex) currentSort.dirAsc = !currentSort.dirAsc;\r\n      else { currentSort.colIndex = colIndex; currentSort.dirAsc = true; }\r\n    } else {\r\n      currentSort.colIndex = colIndex; currentSort.dirAsc = dirAsc;\r\n    }\r\n\r\n    setSortIndicator(currentSort.colIndex, currentSort.dirAsc);\r\n    \r\n    const getVal = (row, idx) => (row.cells[idx].getAttribute('data-sort-value') || row.cells[idx].textContent.trim());\r\n\r\n    visibleRows.sort((a, b) => {\r\n      let cmp = 0;\r\n      // Primary Sort\r\n      const vA = getVal(a, colIndex);\r\n      const vB = getVal(b, colIndex);\r\n      if (!isNaN(vA) && !isNaN(vB) && vA !== '' && vB !== '') cmp = parseFloat(vA) - parseFloat(vB);\r\n      else cmp = String(vA).localeCompare(String(vB), undefined, { numeric: true, sensitivity: 'base' });\r\n\r\n      // Tie-breaker Sort: Client > Site\r\n      if (cmp === 0 && colIndex !== 0) {\r\n        cmp = String(getVal(a, 0)).localeCompare(String(getVal(b, 0)), undefined, { numeric: true, sensitivity: 'base' });\r\n      }\r\n      if (cmp === 0 && colIndex !== 1) {\r\n        cmp = String(getVal(a, 1)).localeCompare(String(getVal(b, 1)), undefined, { numeric: true, sensitivity: 'base' });\r\n      }\r\n\r\n      return currentSort.dirAsc ? cmp : -cmp;\r\n    });\r\n\r\n    tbody.innerHTML = '';\r\n    visibleRows.forEach(r => tbody.appendChild(r));\r\n    rows.filter(r => r.style.display === 'none').forEach(r => tbody.appendChild(r));\r\n  }\r\n\r\n  $$('#reportTable thead th').forEach((th, idx) => {\r\n    th.addEventListener('click', (e) => {\r\n      if (e.target.tagName.toLowerCase() === 'select') return;\r\n      sortTable(idx, true, true);\r\n    });\r\n  });\r\n\r\n  [selects.client, selects.site].filter(Boolean).forEach(sel => sel.addEventListener('change', filterTable));\r\n\r\n  function init() {\r\n    filterTable();\r\n    sortTable(0, true, false); // Default sort by Client\r\n  }\r\n  document.addEventListener('DOMContentLoaded', init);\r\n})();\r\n</script>\r\n{% endblock %}",
    "type": "markdown",
    "depends_on": [
      "client"
    ],
    "template_variables": "data_sources:\n  agentsList:\n    filter:\n      site__client_id: '{{client.id}}'\n    model: agent\n    only:\n    - hostname\n    - operating_system\n    - site__name\n    - site__client__name\n    - last_seen\n    - last_logged_in_user\nreport_run_timestamp: !now"
  },
  "assets": []
}